(function(c,p,l){var m=/\.(jpg|jpeg|png|bmp)$/i;c.fn.popimage=function(a){a=c.extend({dataname:"popimage",removedata:!0,title:"",cursorclass:"cursor-loading",width:!1,height:!1,trigger:"hover focus click",oninit:c.noop,onerror:c.noop},a);var g="";0<=a.trigger.indexOf("hover")&&(g+="mouseenter.popinit");0<=a.trigger.indexOf("focus")&&(g+=" focus.popinit");a.click=0<=a.trigger.indexOf("click");a.click&&(g+=" click.popinit");var q="",n=!1;return this.each(function(){var k=c(this),b=k.attr("href");if(!b||
!m.test(b))if(b=k.data("image"),!b||!m.test(b))return;k.data(a.dataname,{url:b,prevurl:q,nexturl:!1,activated:!1});n&&(n.data(a.dataname).nexturl=b);q=b;n=k;k.one(g,function(b){var d=c(this);d.off(".popinit");d.addClass(a.cursorclass);var g="";if(a.click)if(m.test(d.attr("href")))g=" click";else if("click"==b.type)return;var h=d.data(a.dataname);h.activated=b.type;d.one(("mouseenter"==b.type?"mouseleave":"blur")+".popinit",function(){c(this).data(a.dataname).activated=!1});b=new Image;b.onload=function(){this.onload=
this.onerror=null;d.removeClass(a.cursorclass);var b=this.width/this.height;if(a.width)var e=a.width,f=a.height;else 1<=b?(f=p.innerHeight||l.documentElement.clientHeight||l.body.clientHeight,f=Math.floor(f/2)-20,e=Math.floor(4*f/3)):(e=p.innerWidth||l.documentElement.clientWidth||l.body.clientWidth,e=Math.floor(e/2)-20,f=Math.floor(e/4*3));this.width<=e&&this.height<=f?(e=this.width,f=this.height):e/f>b?e=Math.floor(f*b):f=Math.floor(e/b);var c=d.attr("title");m.test(c)&&(c=a.title);d.popover({container:"body",
content:'<img src="'+h.url+'" width="'+e+'" height="'+f+'" />',delay:120,html:!0,placement:"auto "+(1<=b?"bottom":"right"),template:'<div class="popover popover-image" role="tooltip"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+e+'px;"></h3><div class="popover-content"></div></div>',title:c,trigger:poptriger+g});h.activated&&d.trigger(h.activated);h.nexturl&&(imgnext=new Image,imgnext.onload=imgnext.onerror=function(){this.onload=this.onerror=null},imgnext.src=h.nexturl);
h.prevurl&&(imgprev=new Image,imgprev.imgprev=imgnext.onerror=function(){this.onload=this.onerror=null},imgprev.src=h.prevurl);a.oninit(h.url);a.removedata&&d.data(a.dataname,!1)};b.onerror=function(){this.onload=this.onerror=null;a.onerror(d.data(a.dataname).url);a.removedata&&d.data(a.dataname,!1)};b.src=h.url;return!1})})};c.ready2(function(){"popover"in c.fn&&c("a.photo").popimage({oninit:function(a){litepubl.stat("popimage",{src:a})}})})})(jQuery,window,document);
