(function(d,g,h){g.HTMLUploader=Class.extend({owner:!1,jq:!1,queue:!1,html:'<div id="html-uploader" class="form-group"<label for="file-input">%%lang.upload%%</label><input type="file" id="file-input" name="Filedata" multiple /><div id="dropzone" class="help-block">%%lang.dragfiles%%</div></div>',idhtml:"#file-input, #dropzone",init:function(a){this.owner=a;this.queue=[];this.html=d.simpletml(this.html,{lang:lang.posteditor});var b=this,c=new h.FileReader;d(this.html).appendTo(a.holder).find(this.idhtml).fileReaderJS({accept:a.mime,
readAsDefault:"readAsBinaryString"in c?"BinaryString":"ArrayBuffer",on:{load:function(a,c){b.queue.push(c);1==b.queue.length&&b.start(c)},beforestart:function(b){if(a.maxsize&&b.size>1048576*a.maxsize)return!1}}})},start:function(){this.queue.length&&this.uploadfile(this.queue[0])},next:function(){this.queue.length&&(this.queue.shift(),this.start(),0==this.queue.length&&(this.jq=!1,this.owner.complete()))},uploadfile:function(a){var b=this.owner;b.before(a);var c=new FormData;c.append("Filedata",
a);for(var e in b.postdata)c.append(e,b.postdata[e]);b.setprogress(0);var f=this;this.jq=d.ajax({type:"post",url:b.geturl(),cache:!1,data:c,dataType:"json",contentType:!1,processData:!1,success:function(a){b.uploaded(a);f.next()},xhr:function(){var a=d.ajaxSettings.xhr();"upload"in a&&a.upload.addEventListener("progress",function(a){a.lengthComputable&&b.setprogress(a.loaded,a.total)},!1);return a}}).fail(function(a,c,d){f.next();b.error(a.responseText)})}})})(jQuery,litepubl,window);
