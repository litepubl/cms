(function(b,c,f){c.Homeuploader=Class.extend({dataname:"image",filereader:!1,jq:!1,idinput:"#file-imgupload, #dropzone",helpstatus:!1,init:function(){this.filereader=new f.FileReader;var a={accept:"image/*",readAsDefault:"readAsBinaryString"in this.filereader?"BinaryString":"ArrayBuffer",on:{load:b.proxy(this.upload,this)}};b(this.idinput).fileReaderJS(a);b("body").fileClipboard(a);this.helpstatus=b("#helpstatus")},setstatus:function(a){this.helpstatus.children().addClass("hide");this.helpstatus.find("#img-"+
a).removeClass("hide")},setprogress:function(a,b){var d=Math.ceil(a/b*100);this.helpstatus.find("#img-percent").text(d+"%")},uploaded:function(a){"error"==a.result?this.setstatus("fail"):(this.setstatus("success"),b("#text-image").val(a.result.image),b("#text-smallimage").val(a.result.smallimage))},upload:function(a,c){this.setstatus("percent");var d=new FormData;d.append(this.dataname,c);var e=this;this.jq=b.ajax({type:"post",url:location.href,cache:!1,data:d,dataType:"json",contentType:!1,processData:!1,
success:function(b){e.uploaded(b)},xhr:function(){var a=b.ajaxSettings.xhr();"upload"in a&&a.upload.addEventListener("progress",function(a){a.lengthComputable&&e.setprogress(a.loaded,a.total)},!1);return a}}).fail(function(a,b,c){e.setstatus("fail");alert(a.responseText)})}});b(document).ready(function(){c.homeuploader=new c.Homeuploader})})(jQuery,litepubl,window);
