(function(b,c,d){c.Uploader=Class.extend({handler:!1,postdata:!1,url:"",maxsize:100,mime:!1,types:"*.*",holder:!1,init:function(a){a=b.extend({url:(void 0==ltoptions.uploadurl?ltoptions.url:ltoptions.uploadurl)+"/admin/jsonserver.php",holder:"#uploader",maxsize:100,mime:!1,types:"*.*"},a);b.extend(this,a);this.holder=b(a.holder);this.onbefore=b.Callbacks();this.oncomplete=b.Callbacks();this.onupload=b.Callbacks();this.items=[];(a=b.cookie("litepubl_user"))||(a=b.cookie("admin"));this.postdata={litepubl_user:a,
litepubl_user_id:b.cookie("litepubl_user_id"),method:"files_upload"};this.handler="FileReader"in d?new c.HTMLUploader(this):new c.FlashUploader(this)},geturl:function(){return this.url+"?_="+c.guid++},setpercent:function(a){c.progressbar.setvalue(this.holder,a)},setprogress:function(a,b){a&&b?this.setpercent(Math.ceil(a/b*100)):this.setpercent(0)},showprogress:function(){c.progressbar.add(this.holder)},hideprogress:function(){c.progressbar.remove(this.holder)},error:function(a){b.messagebox(lang.dialog.error,
a)},uploaded:function(a){try{"string"==typeof a&&(a=b.parseJSON(a)),"result"in a?(this.items.push(a.result),this.onupload.fire(a.result)):"error"in a&&this.error(a.error.message)}catch(c){erralert(c)}},addparam:function(a,b){"addparam"in this.handler?this.handler.addparam(a,b):this.postdata[a]=b},addparams:function(){var a=b("#combo-idperm_upload",this.holder.parent());a.length&&this.addparam("idperm",a.val())},before:function(){this.addparams();this.onbefore.fire(this);this.showprogress()},complete:function(){this.hideprogress();
this.oncomplete.fire(this,this.items);this.items.length=0}})})(jQuery,litepubl,window);
