(function(d,g,h){g.Filemanbrowser=Class.extend({perpage:10,pages:!1,fileman:!1,css_small_height:"#posteditor-files-tabs.file-items {height:132px}",init:function(a){this.pages={};this.fileman=a;this.open()},add:function(a){this.fileman.add(a)},open:function(){var a=h.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=h.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,b=this;d.litedialog({title:lang.posteditor.selectfiles,html:this.get_html(),
width:Math.min(720,a-120),height:Math.min(495,c-60),css:495>c-60?this.css_small_height:"",open:function(a){a.on("click.addfile",".file-item",function(){var a=d(this);a.hasClass("file-added")||(a.addClass("file-added"),b.add(a.attr("data-idfile")));return!1});b.loadpage(a.find(".file-items:first"),"1");a=d("#posteditor-files-tabs",a);g.tabs(a,{before:function(a){a=a.children();"empty"==a.attr("data-status")&&b.loadpage(a,a.attr("data-page"))}})},close:function(){b.fileman.dialog=!1},buttons:[{title:lang.dialog.close,
click:d.closedialog}]})},get_html:function(){for(var a=g.tml.fileman,c=Math.ceil(this.fileman.count/this.perpage),b="",f="",e=1;e<=c;e++)b+=a.tabhead.replace(/%%index%%/gim,e),f+=a.tab.replace(/%%index%%/gim,e);return d.parsetml(a.tabs,{head:b,body:f})},loadpage:function(a,c){if(c in this.pages)a.attr("data-status","loaded"),a.append(this.getpage(c));else{var b=this;a.attr("data-status","loading");d.jsonrpc({type:"get",method:"files_getpage",params:{page:c-1,perpage:this.perpage},callback:function(f){b.addpage(c,
f.files);a.attr("data-status","loaded");a.append(b.getpage(c))},error:function(b,c){a.attr("data-status","error");a.append("<p>"+b+"</p>")}})}},addpage:function(a,c){var b=this.pages[a]=[],f=this.fileman.items,e;for(e in c){var d=c[e];f[d.id]=d;parseInt(d.parent)||b.push(d.id)}},getpage:function(a){var c="";a=this.pages[a];var b=this.fileman,f=b.tml.toolbar;b.tml.toolbar="";for(var e=0,g=a.length;e<g;e++){var h=a[e];0>d.inArray(h,b.loaded)&&(c+=b.get_fileitem(h))}b.tml.toolbar=f;return c}})})(jQuery,
litepubl,window);
