(function(b,f,g){litepubl.Posteditor=Class.extend({tabs:!1,init:function(){this.tabs=b("#tabs");if(this.tabs.length){var a=this;this.tabs.tabs({hide:!0,show:!0,beforeLoad:litepubl.uibefore,beforeActivate:function(b,d){a.init_tab(d.newPanel)},load:function(c,d){b(".posteditor-tag",d.panel).click(function(){a.addtag(b(this).text());return!1})}});b("#posteditor-init-raw-tabs").one("click",function(){a.init_raw_tabs();return!1});b("#posteditor-init-files").one("click.initfiles",function(){litepubl.fileman=
new litepubl.Fileman("#posteditor-files");return!1});this.tabs.closest("form").on("submit.posttitle",function(a){var d=b("input[name='title']",this);if(!b.trim(d.val()))return a.stopImmediatePropagation(),b.messagebox(lang.dialog.error,lang.posteditor.emptytitle,function(){d.focus()}),!1})}},init_tab:function(a){b("#datetime-holder",a).length?this.init_datetime_tab(a):b("#seo-holder",a).length&&this.init_seo_tab(a)},addtag:function(a){var c=b("#text-tags").val();if(""==c)b("#text-tags").val(a);else{for(var d=
c.split(/\s*,\s*/),e=d.length;0<=e;e--)if(a==d[e])return!1;b("#text-tags").val(c+", "+a)}},init_seo_tab:function(a){a=b("#seo-holder",a);a.replaceWith(a.get(0).firstChild.nodeValue)},init_datetime_tab:function(a){var c=b("#datetime-holder",a);a=b(c.get(0).firstChild.nodeValue).appendTo(a);c.remove();litepubl.calendar.on(a)},init_raw_tabs:function(){b("#posteditor-init-raw-tabs").remove();var a=b("#posteditor-raw-holder"),c=a.get(0).firstChild.nodeValue;b(a.get(0).firstChild).remove();var c=c.replace(/<comment>/gim,
'<div class="tab-holder">\x3c!--').replace(/<\/comment>/gim,"--\x3e</div>"),d=c.indexOf("<div");b("#posteditor-raw").before(c.substring(0,d)).after(c.substring(d));a.tabs({hide:!0,show:!0,beforeLoad:litepubl.uibefore,beforeActivate:function(a,c){var d=b(".tab-holder",c.newPanel);d.length&&d.replaceWith(d.get(0).firstChild.nodeValue)}})},init_visual_link:function(a,c){b('<a href="#">'+c+"</a>").appendTo("#posteditor-visual").data("url",a).one("click",function(){b.load_script(b(this).data("url"));b("#posteditor-visual").remove();
return!1})}});b(f).ready(function(){try{litepubl.posteditor=new litepubl.Posteditor}catch(a){erralert(a)}})})(jQuery,document,window);
