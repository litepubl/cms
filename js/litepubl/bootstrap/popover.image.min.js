(function(g,k,l){g.Popimage=Class.extend({dataname:"popimage",title:"",cursorclass:"cursor-loading",width:!1,height:!1,oninit:g.noop,onerror:g.noop,init:function(a){this.re=/\.(jpg|jpeg|png|bmp)$/i;var c=this;g(l).on("mouseenter.popinit focus.popinit click.popinit",".photo:not(.popinit)",function(a){return c.add(g(this).addClass("popinit"),a.type)})},add:function(a,c){if(a.data(this.dataname))return!1;var h=!0,b=a.attr("href");if(!b||!this.re.test(b)){if("click"==c)return;b=a.attr("data-image");if(!b||
!this.re.test(b))return;h=!1}a.data(this.dataname,{url:b,click_enabled:h,wait_event:c});var d=this;a.one("mouseenter"==c?"mouseleave.popinit":"blur.popinit",function(){g(this).data(d.dataname).wait_event=!1});a.addClass(this.cursorclass);h=new Image;h.onload=function(){this.onload=this.onerror=null;a.removeClass(d.cursorclass);d.calc_size(a,this.width,this.height)};h.onerror=function(){this.onload=this.onerror=null;a.removeClass(d.cursorclass);d.onerror(this.src)};h.src=b;return!1},calc_size:function(a,
c,h){var b=a.data(this.dataname);b.width=c;b.height=h;var d=c/h;if(this.width)var e=this.width,f=this.height;else e=g(k).width(),f=g(k).height(),1<=d?(f=Math.floor(f/3*2)-40,e=Math.min(e-60,Math.floor(f*d))):(e=Math.floor(e/2)-40,f=Math.min(f-60,Math.floor(e/d)));c<=e&&h<=f?(e=c,f=h):e/f>=d?e=Math.floor(f*d):f=Math.floor(e/d);c=a.attr("title");this.re.test(c)&&(c=this.title);a.popover({container:"body",content:'<img src="'+b.url+'" width="'+e+'" height="'+f+'" />',delay:120,html:!0,placement:"auto "+
(1<=d?"bottom":"right"),template:'<div class="popover popover-image" role="tooltip"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+e+'px;"></h3><div class="popover-content"></div></div>',title:c,trigger:"hover focus"+(b.click_enabled?" click":"")});if(b.click_enabled)a.on("click.popimage",function(){return!1});b.wait_event&&a.trigger(b.wait_event);this.oninit(b.url)}});g.fn.popimage=function(){return this.each(function(){g.popimage.add(g(this).addClass("popinit"),!1)})}})(jQuery,
window,document);
