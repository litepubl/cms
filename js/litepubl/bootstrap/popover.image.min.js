(function(c,k,l){c.Popimage=Class.extend({dataname:"popimage",title:"",cursorclass:"cursor-loading",width:!1,height:!1,oninit:c.noop,onerror:c.noop,init:function(a){this.re=/\.(jpg|jpeg|png|bmp)$/i;var d=this;c(l).on("mouseenter.popinit focus.popinit click.popinit",".photo:not(.popinit)",function(a){return d.add(c(this).addClass("popinit"),a.type)})},add:function(a,d){if(a.data(this.dataname))return!1;var h=!0,b=a.attr("href");if(!b||!this.re.test(b)){if("click"==d)return;b=a.attr("data-image");if(!b||
!this.re.test(b))return;h=!1}a.data(this.dataname,{url:b,click_enabled:h,wait_event:d});var e=this;a.one("mouseenter"==d?"mouseleave.popinit":"blur.popinit",function(){c(this).data(e.dataname).wait_event=!1});a.addClass(this.cursorclass);h=new Image;h.onload=function(){this.onload=this.onerror=null;a.removeClass(e.cursorclass);e.calc_size(a,this.width,this.height)};h.onerror=function(){this.onload=this.onerror=null;a.removeClass(e.cursorclass);e.onerror(this.src)};h.src=b;return!1},calc_size:function(a,
d,h){var b=a.data(this.dataname);b.width=d;b.height=h;var e=d/h;if(this.width)var f=this.width,g=this.height;else f=c(k).width(),g=c(k).height(),1<=e?(g=Math.floor(g/3*2)-40,f=Math.min(f-60,Math.floor(g*e))):(f=Math.floor(f/2)-40,g=Math.min(g-60,Math.floor(f/e)));d<=f&&h<=g?(f=d,g=h):f/g>=e?f=Math.floor(g*e):g=Math.floor(f/e);d=a.attr("title");this.re.test(d)&&(d=this.title);a.popover({container:"body",content:'<img src="'+b.url+'" width="'+f+'" height="'+g+'" />',delay:120,html:!0,placement:"auto "+
(1<=e?"bottom":"right"),template:'<div class="popover popover-image" role="tooltip"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+f+'px;"></h3><div class="popover-content"></div></div>',title:d,trigger:"hover focus"+(b.click_enabled?" click":"")});if(b.click_enabled)a.on("click.popimage",function(){return!1});b.wait_event&&a.trigger(b.wait_event);this.oninit(b.url)}});c.fn.popimage=function(){return this.each(function(){c.popimage.add(c(this).addClass("popinit"),!1)})};c(l).ready(function(){c.popimage=
new c.Popimage})})(jQuery,window,document);
