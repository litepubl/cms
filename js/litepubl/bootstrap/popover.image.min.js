(function(b,l,h){b.Popimage=Class.extend({dataname:"popimage",title:"",cursorclass:"cursor-loading",width:!1,height:!1,oninit:b.noop,onerror:b.noop,init:function(a){this.re=/\.(jpg|jpeg|png|bmp)$/i;var d=this;b(h).on("mouseenter.popinit focus.popinit click.popinit",".photo:not(.popinit)",function(a){return d.add(b(this).addClass("popinit"),a.type)})},add:function(a,d){if(a.data(this.dataname))return!1;var k=!0,c=a.attr("href");if(!c||!this.re.test(c)){if("click"==d)return;c=a.attr("data-image");if(!c||
!this.re.test(c))return;k=!1}a.data(this.dataname,{url:c,click_enabled:k,wait_event:d});var e=this;a.one("mouseenter"==d?"mouseleave.popinit":"blur.popinit",function(){b(this).data(e.dataname).wait_event=!1});a.addClass(this.cursorclass);k=new Image;k.onload=function(){this.onload=this.onerror=null;a.removeClass(e.cursorclass);e.calc_size(a,this.width,this.height)};k.onerror=function(){this.onload=this.onerror=null;a.removeClass(e.cursorclass);e.onerror(this.src)};k.src=c;return!1},calc_size:function(a,
d,b){var c=a.data(this.dataname);c.width=d;c.height=b;var e=d/b;if(this.width)var f=this.width,g=this.height;else f=l.innerWidth||h.documentElement.clientWidth||h.body.clientWidth,g=l.innerHeight||h.documentElement.clientHeight||h.body.clientHeight,1<=e?(g=Math.floor(g/2)-40,f=Math.min(f-60,Math.floor(g*e))):(f=Math.floor(f/2)-40,g=Math.min(g-60,Math.floor(f/e)));d<=f&&b<=g?(f=d,g=b):f/g>=e?f=Math.floor(g*e):g=Math.floor(f/e);d=a.attr("title");this.re.test(d)&&(d=this.title);a.popover({container:"body",
content:'<img src="'+c.url+'" width="'+f+'" height="'+g+'" />',delay:120,html:!0,placement:"auto "+(1<=e?"bottom":"right"),template:'<div class="popover popover-image" role="tooltip"><div class="arrow"></div><h3 class="popover-title" style="max-width:'+f+'px;"></h3><div class="popover-content"></div></div>',title:d,trigger:"hover focus"+(c.click_enabled?" click":"")});c.click_enabled&&a.pophoverclick();c.wait_event&&a.trigger(c.wait_event);this.oninit(c.url)}});b.fn.popimage=function(){return this.each(function(){b.popimage.add(b(this).addClass("popinit"),
!1)})};b(h).ready(function(){b.popimage=new b.Popimage})})(jQuery,window,document);
