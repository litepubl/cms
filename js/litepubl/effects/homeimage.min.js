/*
  2010 - 2016 Vladimir Yushko http://litepublisher.com/ http://litepublisher.ru/
 @license   https://github.com/litepubl/cms/blob/master/LICENSE.txt MIT
 @link https://github.com/litepubl\cms
 @version 6.15
*/
(function(f,h){function k(c){var b=c.data("homeimage");if(!b||b.error)return!1;var a=f(h),d=a.width(),a=a.height();if(b.winw!=d||b.winh!=a){b.winw=d;b.winh=a;var e=d>=b.breakpoint?b.large:b.small;if(e!=b.cur)if(e.w)b.cur=e,b.img.remove(),b.img=f('<img src="'+e.src+'" />').appendTo(c);else{if(e.src)return m(e,function(){b.winw=0;k(c)},function(){e.src=!1;b.winw=0;k(c)});e=b.cur}var d=c.width(),g=a=Math.floor(Math.min(a-b.top,d,e.h)),l=Math.floor(e.w/e.h*a);l<d&&(l=d,g=Math.floor(d/(e.w/e.h)),a>g&&
(a=g));c.height(a);b.img.css({width:l,height:g,left:(d-l)/2,top:(a-g)/2})}}function m(c,b,a){var d=new Image;d.onload=function(){this.onload=this.onerror=null;c.w=this.width;c.h=this.height;b()};d.onerror=function(){this.onload=this.onerror=null;a()};d.src=c.src}f.fn.homeimage=function(c){if(!this.length||this.data("homeimage"))return this;c=f.extend({image:"",small:"",breakpoint:768,addclass:"home-image"},c);if(!c.image&&!c.small)return this;var b=this,a={cur:!1,error:!1,breakpoint:c.breakpoint,
top:this.offset().top,winw:0,winh:0,addclass:c.addclass,img:!1,large:{w:0,h:0,src:c.image},small:{w:0,h:0,src:c.small}};this.data("homeimage",a);this.height(f(h).height()-a.top);c=f(h).width()>=a.breakpoint?a.large:a.small;c.src||(c=c==a.small?a.large:a.small);a.cur=c;m(c,function(){b.addClass(a.addclass);a.img=f('<img src="'+a.cur.src+'" />').appendTo(b);f(h).on("resize.homeimage",function(){k(b)});k(b)},function(){a.error=!0;b.hide();alert("Error! Home image not load")});return this}})(jQuery,window);
