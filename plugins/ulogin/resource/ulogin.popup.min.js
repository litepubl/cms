/*
  2010 - 2016 Vladimir Yushko http://litepublisher.com/ http://litepublisher.ru/
 @license   https://github.com/litepubl/cms/blob/master/LICENSE.txt MIT
 @link https://github.com/litepubl\cms
 @version 6.15
*/
(function(c,e,f){e.Ulogin=Class.extend({url:"/admin/ulogin.php?backurl=",script:!1,status:"wait",css:"",tml:'<div id="ulogin-dialog"><div id="ulogin-holder" data-ulogin="%%data%%"></div></div>',tml_data:"display=small;fields=first_name,last_name;optional=email,phone,nickname;providers=vkontakte,odnoklassniki,mailru,yandex,facebook,google,twitter;hidden=other;redirect_uri=%%redirurl%%;%%callback%%",init:function(){},html:function(a){this.ready();var b=c.isFunction(a.callback)||"object"===typeof a.rpc;
b&&(f.ulogincallback=c.proxy(this.ontoken,this));return this.tml.replace(/%%data%%/gim,c.parsetml(this.tml_data,{redirurl:b?"":encodeURIComponent(ltoptions.url+this.url+encodeURIComponent(a.url)),callback:b?"callback=ulogincallback":""}))},onopen:function(a){this.initOnReady("ulogin-holder");this.script.fail(function(){c("#ulogin-dialog").remove()})},onclose:function(){},autoinit:function(a,b){a=c(a);if(a.length){b=c(b,a);c(".header-help",a).text(lang.authdialog.helptitle);var d=get_get("backurl"),
d=c.parsetml(this.tml_data,{redirurl:encodeURIComponent(ltoptions.url+this.url+(d?encodeURIComponent(d):"")),callback:""});b.attr("data-ulogin",d);this.initOnReady(b.attr("id"))}},initOnReady:function(a){var b=this;this.ready(function(){b.status="script";uLogin.customInit(a);c("[data-uloginbutton]","#"+a).attr("role","button");uLogin.setStateListener(a,"ready",function(){b.status="ready"});uLogin.setStateListener(a,"open",function(){b.status="open"});uLogin.setStateListener(a,"close",function(){b.status=
"close"});uLogin.setStateListener(a,"receive",function(){b.status="receive"})})},ready:function(a){return this.script?this.script.done(a):this.script=c.load_script("//ulogin.ru/js/ulogin.js",a)},ontoken:function(a){this.status="token";var b=e.authdialog;b.setstatus("info",lang.authdialog.request);setTimeout(function(){e.stat("ulogin_token")},10);return c.jsonrpc({method:"ulogin_auth",params:{token:a},slave:b.args.rpc,callback:c.proxy(b.setuser,b),error:function(a,c){b.setstatus("error",a)}})}})})(jQuery,
litepubl,window);
