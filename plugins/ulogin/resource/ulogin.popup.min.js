/*
  2010 - 2016 Vladimir Yushko http://litepublisher.com/ http://litepublisher.ru/
 @license   https://github.com/litepubl/cms/blob/master/LICENSE.txt MIT
 @link https://github.com/litepubl\cms
 @version 6.15
*/
(function(a,e,d){litepubl.Ulogin=Class.extend({url:"/admin/ulogin.php?backurl=",autoinit:"#ulogin-autoinit",script:!1,css:"",tml:'<div id="ulogin-dialog"><div id="ulogin-holder" data-ulogin="%%data%%"></div></div>',tml_admin:'<h4>%%lang.helptitle%%</h4><div id="ulogin-buttons" data-ulogin="%%data%%"></div>',tml_data:"display=small;fields=first_name,last_name;optional=email,phone,nickname;providers=vkontakte,odnoklassniki,mailru,yandex,facebook,google,twitter;hidden=other;redirect_uri=%%redirurl%%;%%callback%%",
init:function(){a.ready2(a.proxy(this.adminbuttons,this))},html:function(b){this.ready();var c=a.isFunction(b.callback)||"object"===typeof b.rpc;c&&(d.ulogincallback=a.proxy(this.ontoken,this));return this.tml.replace(/%%data%%/gim,a.parsetml(this.tml_data,{redirurl:c?"":encodeURIComponent(ltoptions.url+this.url+encodeURIComponent(b.url)),callback:c?"callback=ulogincallback":""}))},onopen:function(b){this.script.done(function(){uLogin.customInit("ulogin-holder")}).fail(function(){a("#ulogin-dialog").remove()})},
onclose:function(){},adminbuttons:function(){var b=a(this.autoinit);if(b.length){var c=a.parsetml(this.tml_admin,{lang:lang.authdialog,data:a.parsetml(this.tml_data,{redirurl:encodeURIComponent(ltoptions.url+this.url+encodeURIComponent(get_get("backurl"))),callback:""})});b.append(c);this.ready(function(){uLogin.customInit("ulogin-buttons")})}},ready:function(b){return this.script?this.script.done(b):this.script=a.load_script("//ulogin.ru/js/ulogin.js",b)},ontoken:function(b){litepubl.authdialog.setstatus("info",
lang.authdialog.request);setTimeout(function(){litepubl.stat("ulogin_token")},10);var c=litepubl.authdialog;return a.jsonrpc({method:"ulogin_auth",params:{token:b},slave:c.args.rpc,callback:a.proxy(c.setuser,c),error:function(a,b){litepubl.authdialog.setstatus("error",a)}})}})})(jQuery,document,window);
