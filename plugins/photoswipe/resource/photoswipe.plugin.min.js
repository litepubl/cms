(function(c,d,g){d.photoswipePlugin=Class.extend({links:!1,opened:!1,photoswipe:!1,holder:!1,options:!1,init:function(a){if(!a.length)return!1;var b=this;this.links=a.on("click.photoswipe",function(){b.open(c(this));return!1});d.openimage=c.proxy(this.openimage,this);c.ready2(c.proxy(this.openhash,this))},getoptions:function(){if(!this.options){var a=lang.photoswipe;d.tml.photoswipe=c.parsetml(d.tml.photoswipe,{lang:a});var b=this;this.options={index:0,history:!0,galleryPIDs:!0,showHideOpacity:!0,
getThumbBoundsFn:!1,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">'+a.error+"</a></div>",shareButtons:this.get_sharebuttons(),getTextForShare:function(a){a=b.pswp.currItem.title||"";if(!a||/\.(jpg|jpeg|png|bmp)$/i.test(a))a=c("title").text();return a}}}return this.options},open:function(a){if(this.opened)return!1;this.opened=!0;a=this.getitems(a.data("idpost"),a.data("file").id);return a.length?this.openitems(a):this.opened=!1},openitems:function(a){if(this.opened||!a.length)return!1;
this.opened=!0;this.holder=c(d.tml.photoswipe).appendTo("body");a=this.photoswipe=new PhotoSwipe(this.holder.get(0),PhotoSwipeUI_Default,a,this.options);a.listen("destroy",c.proxy(this.doclose,this));a.init()},doclose:function(){this.photoswipe=!1;this.holder.remove();this.opened=this.holder=!1},getitems:function(a,b){var h=[],d=this.getoptions();d.galleryUID=parseInt(a);this.links.each(function(g){var e=c(this);if(a==e.data("idpost")){var f=e.data("file");b==f.id&&(d.index=h.length);h.push({src:e.attr("href"),
w:parseInt(f.width),h:parseInt(f.height),title:e.attr("title"),pid:parseInt(f.id),linkindex:g})}});return h},openimage:function(a){var b=this.getoptions();this.options=c.extend({index:0,history:!1,galleryPIDs:!1,shareEl:!1,counterEl:!1,arrowEl:!1},this.options);this.openitems([{src:a.url,w:a.width,h:a.height,title:a.title}]);this.options=b},get_hash:function(){var a=decodeURI(window.location.hash.substring(1));if(5>a.length)return!1;for(var b={},a=a.split("&"),c=0;c<a.length;c++)if(a[c]){var d=a[c].split("=");
2>d.length||(b[d[0]]=d[1])}return{gid:"gid"in b?parseInt(b.gid,10):0,pid:"pid"in b?parseInt(b.pid,10):0}},openhash:function(){var a=this.get_hash();a&&a.pid&&a.gid&&(a=this.getitems(a.gid,a.pid),this.openitems(a))},get_sharebuttons:function(){var a=lang.photoswipe,b=[{id:"photoswipe-facebook",label:'<span class="fa fa-facebook"> FaceBook',url:"https://www.facebook.com/dialog/feed?app_id="+ltoptions.facebook_appid+"&link=[url]&name=[text]&picture=[image_url]&display=popup&redirect_uri="+encodeURIComponent(ltoptions.files+
"/files/close-window.htm")},{id:"photoswipe-twitter",label:'<span class="fa fa-twitter"></span> Tweet',url:"https://twitter.com/share?lang="+ltoptions.lang+"&url=[url]&text=[text]"},{id:"photoswipe-pinterest",label:'<span class="fa fa-pinterest"></span> Pin it',url:"http://www.pinterest.com/pin/create/button/?url=[url]&media=[image_url]&description=[text]"}];"ru"==ltoptions.lang&&(b.push({id:"photoswipe-vk",label:'<span class="fa fa-vk"></span> '+a.vk,url:"https://vk.com/share.php?url=[url]"}),b.push({id:"photoswipe-odnoklassniki",
label:'<span class="odnoklassniki-icon"></span> '+a.ok,url:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl=[url]&st.comments=[text]"}));b.push({id:"photoswipe-download",label:'<span class="fa fa-download"></span>'+a.downlload,url:"[raw_image_url]",download:!0});for(a=b.length-1;0<=a;a--)b[a].url=b[a].url.replace(/\[/g,"{{").replace(/\]/g,"}}");return b}});c(g).ready(function(){d.photoswipe=new d.photoswipePlugin(c(".photo"))})})(jQuery,litepubl,document);
