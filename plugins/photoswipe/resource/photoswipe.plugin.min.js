(function(d,b,l){b.photoswipePlugin=Class.extend({links:!1,opened:!1,photoswipe:!1,holder:!1,options:!1,init:function(a){if(!a.length)return!1;var c=this;this.links=a.on("click.photoswipe",function(){c.open(d(this));return!1});b.openimage=d.proxy(this.openimage,this);d.ready2(d.proxy(this.openhash,this))},getoptions:function(){if(!this.options){var a=lang.photoswipe;b.tml.photoswipe=d.parsetml(b.tml.photoswipe,{lang:a});var c=this;this.options={index:0,history:!0,galleryPIDs:!0,showHideOpacity:!0,
getThumbBoundsFn:!1,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">'+a.error+"</a></div>",shareButtons:this.get_sharebuttons(),getTextForShare:function(a){a=c.pswp.currItem.title||"";if(!a||/\.(jpg|jpeg|png|bmp)$/i.test(a))a=d("title").text();return a}}}return this.options},open:function(a){if(this.opened)return!1;this.opened=!0;a=this.getitems(a.data("idpost"),a.data("file").id);this.opened=!1;return a.length?this.openitems(a):!1},openitems:function(a){if(this.opened||!a.length)return!1;
this.opened=!0;b.stat("photoswipe_opening");this.holder=d(b.tml.photoswipe).appendTo("body");a=this.photoswipe=new PhotoSwipe(this.holder.get(0),PhotoSwipeUI_Default,a,this.options);a.listen("destroy",d.proxy(this.doclose,this));this.setstatevents(a);a.init()},doclose:function(){this.photoswipe=!1;this.holder.remove();this.opened=this.holder=!1;b.stat("photoswipe_closed")},getitems:function(a,c){var b=[],m=768>=d(window).width(),h=this.getoptions();h.galleryUID=parseInt(a);this.links.each(function(k){var e=
d(this);if(a==e.data("idpost")){var f=e.data("file"),g=e.data("midle");c==f.id&&(h.index=b.length);m&&g?b.push({src:g.link,w:parseInt(g.width),h:parseInt(g.height),title:e.attr("title"),pid:parseInt(f.id),linkindex:k}):b.push({src:e.attr("href"),w:parseInt(f.width),h:parseInt(f.height),title:e.attr("title"),pid:parseInt(f.id),linkindex:k})}});return b},openimage:function(a){var c=this.getoptions();this.options=d.extend({index:0,history:!1,galleryPIDs:!1,shareEl:!1,counterEl:!1,arrowEl:!1},this.options);
this.openitems([{src:a.url,w:a.width,h:a.height,title:a.title}]);this.options=c},get_hash:function(){var a=decodeURI(window.location.hash.substring(1));if(5>a.length)return!1;for(var c={},a=a.split("&"),b=0;b<a.length;b++)if(a[b]){var d=a[b].split("=");2>d.length||(c[d[0]]=d[1])}return{gid:"gid"in c?parseInt(c.gid,10):0,pid:"pid"in c?parseInt(c.pid,10):0}},openhash:function(){var a=this.get_hash();a&&a.pid&&a.gid&&(a=this.getitems(a.gid,a.pid),this.openitems(a))},get_sharebuttons:function(){var a=
lang.photoswipe,c=[{id:"photoswipe-facebook",label:'<span class="fa fa-facebook"> FaceBook',url:"https://www.facebook.com/dialog/feed?app_id="+ltoptions.facebook_appid+"&link=[url]&name=[text]&picture=[image_url]&display=popup&redirect_uri="+encodeURIComponent(ltoptions.files+"/files/close-window.htm")},{id:"photoswipe-twitter",label:'<span class="fa fa-twitter"></span> Tweet',url:"https://twitter.com/share?lang="+ltoptions.lang+"&url=[url]&text=[text]"},{id:"photoswipe-pinterest",label:'<span class="fa fa-pinterest"></span> Pin it',
url:"http://www.pinterest.com/pin/create/button/?url=[url]&media=[image_url]&description=[text]"}];"ru"==ltoptions.lang&&(c.push({id:"photoswipe-vk",label:'<span class="fa fa-vk"></span> '+a.vk,url:"https://vk.com/share.php?url=[url]"}),c.push({id:"photoswipe-odnoklassniki",label:'<span class="odnoklassniki-icon"></span> '+a.ok,url:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl=[url]&st.comments=[text]"}));c.push({id:"photoswipe-download",label:'<span class="fa fa-download"></span>'+
a.downlload,url:"[raw_image_url]",download:!0});for(a=c.length-1;0<=a;a--)c[a].url=c[a].url.replace(/\[/g,"{{").replace(/\]/g,"}}");return c},setstatevents:function(a){a.listen("afterChange",function(){b.stat("photoswipe_afterChange",{index:a.getCurrentIndex(),linkindex:a.currItem.linkindex,idimage:a.currItem.pid})});a.listen("shareLinkClick",function(a,d){b.stat("photoswipe_shareLinkClick",{url:d.href})})}});d(l).ready(function(){b.photoswipe=new b.photoswipePlugin(d(".photo"))})})(jQuery,litepubl,
document);
