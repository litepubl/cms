(function(b,h,d){litepubl.photoswipePlugin=Class.extend({links:!1,opened:!1,photoswipe:!1,holder:!1,options:{},init:function(a){if(!a.length)return!1;var c=this;this.options={galleryPIDs:!0,getThumbBoundsFn:function(a){a=c.links.eq(c.photoswipe.items[a].linkindex).find("img");var b=a.offset();return{x:b.left,y:b.top,w:a.width()}}};this.links=a.on("click.photoswipe",function(){c.open(b(this));return!1});litepubl.tml.photoswipe=b.parsetml(litepubl.tml.photoswipe,{lang:lang.photoswipe})},open:function(a){if(this.opened)return!1;
this.opened=!0;a=this.getitems(a);this.holder=b(litepubl.tml.photoswipe).appendTo("body");a=this.photoswipe=new PhotoSwipe(this.holder.get(0),PhotoSwipeUI_Default,a,this.options);a.listen("destroy",b.proxy(this.doclose,this));a.init()},doclose:function(){this.photoswipe=!1;this.holder.remove();this.opened=this.holder=!1},getitems:function(a){var c=[],e=a.data("idpost"),d=a.data("json").id,f=0,g=this.options;g.galleryUID=parseInt(e);this.links.each(function(){f++;$this=b(this);if(e==$this.data("idpost")){var a=
$this.data("json");d==a.id&&(g.index=c.length);c.push({src:$this.attr("href"),msrc:b("img",$this).attr("src"),w:parseInt(a.width),h:parseInt(a.height),title:$this.attr("title"),pid:parseInt(a.id),linkindex:f})}});return c}});b(d).ready(function(){litepubl.photoswipe=new litepubl.photoswipePlugin(b(".photo"))})})(jQuery,window,document);
