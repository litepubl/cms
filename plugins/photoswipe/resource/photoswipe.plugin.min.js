(function(b,c,m){c.photoswipePlugin=Class.extend({links:!1,opened:!1,photoswipe:!1,ready:!0,script:!1,holder:!1,options:!1,animatethumbs:!1,onoptions:b.noop,init:function(a){this.ready="photoswipe"in c.tml;c.openimage=b.proxy(this.openimage,this);if(a&&a.length){var d=this;this.links=a.on("click.photoswipe",function(){d.open(b(this));return!1});if(!this.ready)a.one("focus.ready mouseenter.ready",b.proxy(this.load_script,this,!1));b.ready2(b.proxy(this.openhash,this))}},load_script:function(a){if(this.script)this.script.done(a);
else{var d=this;this.script=b.load_script(ltoptions.files+"/files/js/photoswipe."+ltoptions.jsmerger+".js",function(){d.ready=!0;a&&a()})}},getoptions:function(){if(!this.options){var a=lang.photoswipe;c.tml.photoswipe=b.parsetml(c.tml.photoswipe,{lang:a});var d=this;this.options={index:0,history:!0,galleryPIDs:!0,showHideOpacity:!this.animatethumbs,getThumbBoundsFn:this.animatethumbs?function(a){a=d.links.eq(d.photoswipe.items[a].linkindex).find("img");var b=a.offset();return{x:b.left,y:b.top,w:a.data("width")}}:
!1,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">'+a.error+"</a></div>",shareButtons:this.get_sharebuttons(),getTextForShare:function(a){a=d.photoswipe.currItem.title||"";if(!a||/\.(jpg|jpeg|png|bmp)$/i.test(a))a=b("title").text();return a}};this.onoptions(this.options)}return this.options},open:function(a){if(!this.ready)return this.load_script(b.proxy(this.open,this,a));if(this.opened)return!1;this.opened=!0;a=this.getitems(a.data("idpost"),a.data("file").id);this.opened=
!1;return a.length?this.openitems(a):!1},openitems:function(a){if(this.opened||!a.length)return!1;if(!this.ready)return this.load_script(b.proxy(this.openitems,this,a));this.opened=!0;c.stat("photoswipe_opening");this.holder=b(c.tml.photoswipe).appendTo("body");a=this.photoswipe=new PhotoSwipe(this.holder.get(0),PhotoSwipeUI_Default,a,this.options);a.listen("destroy",b.proxy(this.doclose,this));this.setstatevents(a);a.init()},doclose:function(){this.photoswipe=!1;this.holder.remove();this.opened=
this.holder=!1;c.stat("photoswipe_closed")},getitems:function(a,d){var c=[],n=768>=b(window).width(),h=this.animatethumbs,k=this.getoptions();k.galleryUID=parseInt(a);this.links.each(function(l){var e=b(this);if(a==e.data("idpost")){var f=e.data("file"),g=e.data("midle");d==f.id&&(k.index=c.length);n&&g?c.push({src:g.link,msrc:h?b("img",e).attr("src"):!1,w:parseInt(g.width),h:parseInt(g.height),title:e.attr("title"),pid:parseInt(f.id),linkindex:l}):c.push({src:e.attr("href"),msrc:h?b("img",e).attr("src"):
!1,w:parseInt(f.width),h:parseInt(f.height),title:e.attr("title"),pid:parseInt(f.id),linkindex:l})}});return c},openimage:function(a){if(!this.ready)return this.load_script(b.proxy(this.openimage,this,a));var d=this.getoptions();this.options=b.extend({index:0,history:!1,galleryPIDs:!1,shareEl:!1,counterEl:!1,arrowEl:!1,showHideOpacity:!0,getThumbBoundsFn:!1},this.options);this.openitems([{src:a.url,w:a.width,h:a.height,title:a.title}]);this.options=d},get_hash:function(){var a=decodeURI(window.location.hash.substring(1));
if(5>a.length)return!1;for(var d={},a=a.split("&"),b=0;b<a.length;b++)if(a[b]){var c=a[b].split("=");2>c.length||(d[c[0]]=c[1])}return{gid:"gid"in d?parseInt(d.gid,10):0,pid:"pid"in d?parseInt(d.pid,10):0}},openhash:function(){var a=this.get_hash();a&&a.pid&&a.gid&&(a=this.getitems(a.gid,a.pid),this.openitems(a))},get_sharebuttons:function(){var a=lang.photoswipe,b=[{id:"photoswipe-facebook",label:'<span class="fa fa-facebook"> FaceBook',url:"https://www.facebook.com/dialog/feed?app_id="+ltoptions.facebook_appid+
"&link=[url]&name=[text]&picture=[image_url]&display=popup&redirect_uri="+encodeURIComponent(ltoptions.files+"/files/close-window.htm")},{id:"photoswipe-twitter",label:'<span class="fa fa-twitter"></span> Tweet',url:"https://twitter.com/share?lang="+ltoptions.lang+"&url=[url]&text=[text]"},{id:"photoswipe-pinterest",label:'<span class="fa fa-pinterest"></span> Pin it',url:"http://www.pinterest.com/pin/create/button/?url=[url]&media=[image_url]&description=[text]"}];"ru"==ltoptions.lang&&(b.push({id:"photoswipe-vk",
label:'<span class="fa fa-vk"></span> '+a.vk,url:"https://vk.com/share.php?url=[url]"}),b.push({id:"photoswipe-odnoklassniki",label:'<span class="odnoklassniki-icon"></span> '+a.ok,url:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1&st._surl=[url]&st.comments=[text]"}));b.push({id:"photoswipe-download",label:'<span class="fa fa-download"></span>'+a.downlload,url:"[raw_image_url]",download:!0});for(a=b.length-1;0<=a;a--)b[a].url=b[a].url.replace(/\[/g,"{{").replace(/\]/g,"}}");return b},setstatevents:function(a){a.listen("afterChange",
function(){c.stat("photoswipe_afterChange",{index:a.getCurrentIndex(),linkindex:a.currItem.linkindex,idimage:a.currItem.pid})});a.listen("shareLinkClick",function(a,b){c.stat("photoswipe_shareLinkClick",{url:b.href})})}});b(m).ready(function(){c.photoswipe=new c.photoswipePlugin(b(".photo"))})})(jQuery,litepubl,document);
