(function(a,e,f){a.pollclient={enabled:!0,voted:[],init:function(){a(".pollitem").click(function(){var b=a(this);a.pollclient.clickvote(b.data("idpoll"),b.data("index"),b.closest(".activepoll"));return!1});a(".submit-radio-poll").click(function(){var b=a(this),c=b.closest(".activepoll"),d=a("input:radio:checked",c).val();a.pollclient.clickvote(b.data("idpoll"),d,c);return!1})},clickvote:function(b,c,d){if(0<=a.inArray(b,this.voted))return this.error(lang.poll.voted);if(!this.enabled)return!1;this.setenabled(!1);
this.voted.push(b);a.jsonrpc({type:"get",method:"polls_sendvote",params:{idpoll:b,vote:c},callback:function(b){if("error"==b.code)return a.pollclient.error(b.message);a.pollclient.setenabled(!0);var c=d.next(".poll-result");a(".votes",c).text(b.total);a(".average",c).text(b.rate);a(".poll-votes",c).each(function(){var c=a(this).data("index");c in b.votes&&a(this).text(b.votes[c])})},error:a.proxy(a.pollclient.error,a.pollclient)})},error:function(b){a.pollclient.setenabled(!0);a.messagebox(lang.dialog.error,
b)},setenabled:function(b){b!=this.enabled&&((this.enabled=b)?a(":input",".activepoll").removeAttr("disabled"):a(":input",".activepoll").attr("disabled","disabled"))}};a(e).ready(function(){litepubl.getuser().id&&a.pollclient.init()})})(jQuery,document,window);
