(function(b,e,d){d.Polls=Class.extend({voted:!1,init:function(){this.voted=[];var c=this;b(e).on("click.poll",".poll-vote",function(){var a=b(this);c.addvote(a.attr("data-vote"),a.closest(".poll-opened"));return!1}).on("show.bs.tooltip.poll",".poll-star",function(a){a=b(a.target);c.changestars(a.attr("data-vote"),a.closest(".poll-opened"))}).on("hide.bs.tooltip.poll",".poll-star",function(a){b(a.target).closest(".poll-opened").find(".fa-star").removeClass("fa-star").addClass("fa-star-o")})},addvote:function(c,
a){var f=a.attr("data-idpoll");if(0<=b.inArray(f,this.voted))return b.errorbox(lang.poll.voted);this.voted.push(f);this.changestars(c,a);var e=this;d.authdialog.check({rpc:{type:"get",method:"polls_sendvote",params:{idpoll:f,vote:c},callback:function(d){a.find(".tooltip-toggle, .tooltip-ready").tooltip("destroy");a=b(d.html).replaceAll(a);a.find(".tooltip-toggle").removeClass("tooltip-toggle");e.changestars(c,a)},error:function(a,c){b.errorbox(a)}}})},changestars:function(c,a){a.hasClass("poll-stars")&&
a.find(".poll-star").each(function(){c>=b(this).attr("data-vote")&&b(".fa-star-o",this).removeClass("fa-star-o").addClass("fa-star")})}});b(function(){d.polls=new d.Polls})})(jQuery,document,litepubl);
