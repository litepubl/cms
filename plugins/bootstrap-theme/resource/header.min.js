(function(a,d,f){d.Headereditor=Class.extend({file:!1,style:!1,filereader:!1,jq:!1,idinput:"#file-input, #dropzone",savebutton:!1,helpstatus:!1,init:function(){this.filereader=new f.FileReader;var c={accept:"image/*",readAsDefault:"DataURL",on:{load:a.proxy(this.add,this)}};a(this.idinput).fileReaderJS(c);a("body").fileClipboard(c);var b=this;this.savebutton=a("#submitbutton-update").on("click.header",function(){b.file&&(a(this).prop("disabled",!0),b.submit());return!1});this.helpstatus=a("#helpstatus")},
add:function(c,b){this.file=b;var g=d.tml.header.replace("%%file%%",c.target.result);this.style&&this.style.remove();this.style=a('<style type="text/css">'+g+"</style>").appendTo("head:first");this.setstatus("warnsize",3E4<b.size)},setstatus:function(c,b){this.helpstatus.children().addClass("hide");b&&this.helpstatus.find("#"+c).removeClass("hide")},submit:function(){this.setstatus("percent",!0);this.upload("image",this.file)},setprogress:function(c,b){var a=Math.ceil(c/b*100);this.helpstatus.find("#percent").text(a+
"%")},uploaded:function(a){this.savebutton.prop("disabled",!1);this.setstatus("success",!0)},upload:function(c,b){var d=new FormData;d.append(c,b);var e=this;this.jq=a.ajax({type:"post",url:location.href,cache:!1,data:d,dataType:"json",contentType:!1,processData:!1,success:function(a){e.uploaded(a)},xhr:function(){var b=a.ajaxSettings.xhr();"upload"in b&&b.upload.addEventListener("progress",function(a){a.lengthComputable&&e.setprogress(a.loaded,a.total)},!1);return b}}).fail(function(a,b,c){e.savebutton.prop("disabled",
!1);e.setstatus("fail",!0);alert(a.responseText)})}});a(document).ready(function(){d.headereditor=new d.Headereditor})})(jQuery,litepubl,window);
