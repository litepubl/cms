(function(a,f,h){f.Headereditor=Class.extend({name:"header",logofile:!1,headerfile:!1,logo:!1,header:!1,filereader:!1,jq:!1,idinput:"#file-input, #dropzone",savebutton:!1,helpstatus:!1,init:function(){this.filereader=new h.FileReader;var d={accept:"image/*",readAsDefault:"DataURL",on:{load:a.proxy(this.add,this)}};a(this.idinput).fileReaderJS(d);a("body").fileClipboard(d);var b=this;this.savebutton=a("#submitbutton-update").on("click.header",function(){b[b.name+"file"]&&(a(this).prop("disabled",!0),
b.submit());return!1});a("input[name=radioplace]").on("change.place",function(){"header"==a(this).attr("value")?(b.name="header",a("#headerhelp").removeClass("hide"),a("#logohelp").addClass("hide")):(b.name="logo",a("#headerhelp").addClass("hide"),a("#logohelp").removeClass("hide"))});this.helpstatus=a("#helpstatus")},add:function(d,b){this[this.name+"file"]=b;this[this.name]&&this[this.name].remove();var c=f.tml[this.name].replace("%%file%%",d.target.result);if("logo"==this.name){var e=this,g=new Image;
g.onload=function(){this.onload=null;c=c.replace("%%width%%",this.width);e.logo=a('<style type="text/css">'+c+"</style>").appendTo("head:first")};g.src=d.target.result}else this[this.name]=a('<style type="text/css">'+c+"</style>").appendTo("head:first");this.setstatus("warnsize",3E4<b.size)},setstatus:function(a,b){this.helpstatus.children().addClass("hide");b&&this.helpstatus.find("#"+a).removeClass("hide")},submit:function(){this.setstatus("percent",!0);this.upload(this.name,this[this.name+"file"])},
setprogress:function(a,b){var c=Math.ceil(a/b*100);this.helpstatus.find("#percent").text(c+"%")},uploaded:function(a){this.savebutton.prop("disabled",!1);"ok"==a.result?this.setstatus("success",!0):this.setstatus("error",!0)},upload:function(d,b){var c=new FormData;c.append(d,b);var e=this;this.jq=a.ajax({type:"post",url:location.href,cache:!1,data:c,dataType:"json",contentType:!1,processData:!1,success:function(a){e.uploaded(a)},xhr:function(){var b=a.ajaxSettings.xhr();"upload"in b&&b.upload.addEventListener("progress",
function(a){a.lengthComputable&&e.setprogress(a.loaded,a.total)},!1);return b}}).fail(function(a,b,c){e.savebutton.prop("disabled",!1);e.setstatus("fail",!0);alert(a.responseText)})}});a(document).ready(function(){f.headereditor=new f.Headereditor})})(jQuery,litepubl,window);
